<!DOCTYPE html>
<html>

<head>
  <title>RSVP News Settings</title>
  <link rel='stylesheet' type='text/css' href='css/slate.min.css'>
  <script src='js/slate.min.js'></script>
  <style>
    .title {
      padding: 15px 10px;
      text-transform: uppercase;
      font-family: 'PT Sans', sans-serif;
      font-size: 1.2em;
      font-weight: 500;
      color: #888888;
      text-align: center;
    }
  </style>
</head>

<body>
  <h1 class='title'>RSVP News Settings</h1>

  <div class='item-container'
    style='background-color: #1a73e8; border-radius: 8px; margin: 10px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);'>
    <div style='color: #ffffff; text-align: center;'>
      <strong style='font-size: 1.2em;'>âš¡ RSVP Speed Reading</strong>
      <p style='margin: 10px 0 0 0; font-size: 0.9em; line-height: 1.4;'>
        RSVP (Rapid Serial Visual Presentation) displays words one at a time in the same spot,
        eliminating eye movements and enabling ultra-fast reading.
        The Spritz method can boost your reading speed up to 1000 words per minute!
      </p>
    </div>
  </div>

  <div class='item-container'>
    <div class='item-container-header'>RSS Feed URL</div>
    <div class='item-container-content'>
      <label class='item'>
        <div class='item-input-wrapper'>
          <input type='text' class='item-input' input id='input_news_feed_url' placeholder='https://rss.app/feeds/...'>
        </div>
      </label>
      <div class='item-container-footer'>
        Quick presets:
      </div>
      <div style='display: flex; flex-wrap: wrap; justify-content: space-between; padding: 5px 0;'>
        <button type='button' class='item-button' style='flex: 1 1 30%; margin: 2px; font-size: 0.75em; padding: 8px 4px;'
          onclick="document.getElementById('input_news_feed_url').value='https://feeds.bbci.co.uk/news/world/rss.xml'">BBC World</button>
        <button type='button' class='item-button' style='flex: 1 1 30%; margin: 2px; font-size: 0.75em; padding: 8px 4px;'
          onclick="document.getElementById('input_news_feed_url').value='https://rss.nytimes.com/services/xml/rss/nyt/World.xml'">NY Times</button>
        <button type='button' class='item-button' style='flex: 1 1 30%; margin: 2px; font-size: 0.75em; padding: 8px 4px;'
          onclick="document.getElementById('input_news_feed_url').value='https://feeds.npr.org/1001/rss.xml'">NPR News</button>
      </div>
      <div style='display: flex; flex-wrap: wrap; justify-content: space-between; padding: 5px 0;'>
        <button type='button' class='item-button' style='flex: 1 1 30%; margin: 2px; font-size: 0.75em; padding: 8px 4px;'
          onclick="document.getElementById('input_news_feed_url').value='https://www.theguardian.com/world/rss'">Guardian</button>
        <button type='button' class='item-button' style='flex: 1 1 30%; margin: 2px; font-size: 0.75em; padding: 8px 4px;'
          onclick="document.getElementById('input_news_feed_url').value='https://www.lemonde.fr/rss/une.xml'">Le Monde</button>
        <button type='button' class='item-button' style='flex: 1 1 30%; margin: 2px; font-size: 0.75em; padding: 8px 4px;'
          onclick="document.getElementById('input_news_feed_url').value='https://feeds.reuters.com/reuters/topNews'">Reuters</button>
      </div>
    </div>
  </div>

  <div class='item-container' style='border-radius: 8px; margin: 10px;'>
    <div class='item-container-header' style='background-color: #34a853; color: white;'>Reading Speed</div>
    <div class='item-container-content' style='padding: 15px;'>
      <label class='item'>
        <div class='item-input' style='text-align: center;'>
          <input type='range' id='input_reading_speed' min='150' max='600' step='50' value='400' style='width: 100%;'
            oninput='updateSpeedDisplay()'>
        </div>
      </label>
      <div style='text-align: center; margin-top: 10px;'>
        <span id='speed_display' style='font-size: 1.2em; font-weight: bold; color: #34a853;'>400 WPM</span>
        <div style='font-size: 0.85em; color: #666; margin-top: 5px;'>
          <span style='float: left;'>Slow</span>
          <span style='float: right;'>Fast</span>
          <div style='clear: both;'></div>
        </div>
      </div>
    </div>
  </div>

  <div class='item-container' style='border-radius: 8px; margin: 10px;'>
    <div class='item-container-header' style='background-color: #ff9800; color: white;'>Display Options</div>
    <div class='item-container-content' style='padding: 15px;'>
      <label class='item' style='display: flex; align-items: center; justify-content: space-between;'>
        <div style='flex: 1;'>
          <div style='font-weight: bold; margin-bottom: 5px;'>Keep Backlight On</div>
          <div style='font-size: 0.85em; color: #666;'>Keeps screen lit while reading for better visibility</div>
        </div>
        <div style='margin-left: 15px;'>
          <input type='checkbox' id='input_backlight_enabled' checked style='width: 24px; height: 24px;'>
        </div>
      </label>
    </div>
  </div>

  <div class='item-container'>
    <div class='button-container'>
      <input id='submit_button' type='button' class='item-button' value='SUBMIT'>
    </div>
  </div>

  <div class='item-container-footer'>
    If you REALLY like this app <br>
    you can give me a little something on Paypal <a href='https://paypal.me/ChrJeannette'>here</a>. <br>
    - Otherwise just enjoy it, it's free !<br><br><br>
  </div>

</body>

<script>

  function updateSpeedDisplay() {
    var speedInput = document.getElementById('input_reading_speed');
    var speedDisplay = document.getElementById('speed_display');
    speedDisplay.textContent = speedInput.value + ' WPM';
  }

  function getConfigData() {
    var input_news_feed_url = document.getElementById('input_news_feed_url');
    var input_reading_speed = document.getElementById('input_reading_speed');
    var input_backlight_enabled = document.getElementById('input_backlight_enabled');

    var options = {
      'input_news_feed_url': input_news_feed_url.value,
      'reading_speed_wpm': parseInt(input_reading_speed.value),
      'backlight_enabled': input_backlight_enabled.checked
    };

    // Save for next launch
    localStorage['input_news_feed_url'] = options['input_news_feed_url'];
    localStorage['reading_speed_wpm'] = options['reading_speed_wpm'];
    localStorage['backlight_enabled'] = options['backlight_enabled'];

    console.log('Got options: ' + JSON.stringify(options));
    return options;
  }

  function getQueryParam(variable, defaultValue) {
    var query = location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split('=');
      if (pair[0] === variable) {
        return decodeURIComponent(pair[1]);
      }
    }
    return defaultValue || false;
  }

  var submitButton = document.getElementById('submit_button');
  submitButton.addEventListener('click', function () {
    console.log('Submit');

    // Set the return URL depending on the runtime environment
    var return_to = getQueryParam('return_to', 'pebblejs://close#');
    document.location = return_to + encodeURIComponent(JSON.stringify(getConfigData()));
  });

  (function () {
    var input_news_feed_url = document.getElementById('input_news_feed_url');
    var input_reading_speed = document.getElementById('input_reading_speed');
    var input_backlight_enabled = document.getElementById('input_backlight_enabled');

    input_news_feed_url.value = localStorage['input_news_feed_url'] || 'https://feeds.bbci.co.uk/news/world/rss.xml';
    input_reading_speed.value = localStorage['reading_speed_wpm'] || '270';
    input_backlight_enabled.checked = localStorage['backlight_enabled'] !== 'false'; // Default true
    updateSpeedDisplay();
  })();
</script>

</html>